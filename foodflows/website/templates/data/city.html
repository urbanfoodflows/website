{% extends "_base.html" %}
{% load foodflows_extras %}
{% load humanize %}

{% block title %}Food Production Comparison{% endblock %}

{% block footer %}
<script>

var chartDom = document.getElementById('main');
var myChart = echarts.init(chartDom);
var option;

var foodsupply_other = {{ foodsupply_total }};
{% for each in foodsupply %}
foodsupply_other -= {{ each.per_capita }};
{% endfor %}

option = {
  title: {
    text: '{{ foodsupply_total|floatformat:0 }} kg/cap',
    left: 'center',
    top: 'center'
  },
  color: [{% for each in foodsupply %}'{{ each.food_group__color }}',{% endfor %}'black'],
  series: [
    {
      name: 'Food group',
      type: 'pie',
      radius: ['40%', '70%'],
      avoidLabelOverlap: true,
      data: [
        {% for each in foodsupply %}
        { value: {{ each.per_capita|floatformat:1 }}, name: '{{ each.food_group__name|safe }}' },
        {% endfor %}
        { value: foodsupply_other, name: 'Other' }
      ]
    }
  ]
};

option && myChart.setOption(option);
</script>
{% endblock %}

{% block content %}

<div class="row">

  <div class="col-2 p-3 bg-body-tertiary">
    {% include "_menu.city.html" %}
  </div>

  <div class="col-10">

    <div class="row">

      <div class="col-6">

        <h2>Production</h2>
        <table class="table table-striped table-bars table-sm">
          <tr>
            <th>Food</th>
            <th>Quantity (kg/cap)</th>
          </tr>
          {% for each in production %}
            <tr>
              <td>{{ each.food }}</td>
              <td>
                <span class="number">{{ each.quantity_per_capita|floatformat:1 }}</span>
                <div class="cell-bar"></div>
              </td>
            </tr>
          {% endfor %}
        </table>

        <h2>Imports</h2>
        <table class="table table-striped table-bars table-sm">
          <tr>
            <th>Food</th>
            <th>Quantity (kg/cap)</th>
          </tr>
          {% for each in imports %}
            <tr>
              <td>{{ each.food }}</td>
              <td>
                <span class="number">{{ each.quantity_per_capita|floatformat:1 }}</span>
                <div class="cell-bar"></div>
              </td>
            </tr>
          {% endfor %}
        </table>


      </div>

      <div class="col-6 bg-body-secondary">

        <h2>Food supply</h2>

        <div id="main" style="width:100%;height:500px"></div>

      </div>

    </div>


  </div>

</div>

{% endblock %}
