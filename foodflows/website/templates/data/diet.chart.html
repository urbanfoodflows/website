{% extends "_base.html" %}
{% load foodflows_extras %}

{% block title %}Ideal Diet Analysis{% endblock %}

{% block header %}
<script type="text/javascript">

  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    var oldData = google.visualization.arrayToDataTable([
      ['Food group', 'Quantity'],
      {% for each in ideal %}
      ['{{ each }}', {{ each.quantity }}],
      {% endfor %}
    ]);

    {% for city in cities %}
    var newData{{ city.id }} = google.visualization.arrayToDataTable([
      ['Food group', '{{ city }}'],
      {% for each in ideal %}
      {% if totals|get_item:city.id|get_item:each.id %}
      ['{{ each|safe|truncatechars_html:15 }}', {{ totals|get_item:city.id|get_item:each.id }}],
      {% endif %}
      {% endfor %}
    ]);
    {% endfor %}

    var colChartBefore = new google.visualization.ColumnChart(document.getElementById('colchart_before'));
    var colChartAfter = new google.visualization.ColumnChart(document.getElementById('colchart_after'));
    var colChartDiff = new google.visualization.ColumnChart(document.getElementById('colchart_diff'));

    {% for each in cities %}
      var diff_{{ each.id }} = new google.visualization.BarChart(document.getElementById('diff_{{ each.id }}'));
    {% endfor %}

    var options = { legend: { position: 'top' } };

    colChartBefore.draw(oldData, options);
    colChartAfter.draw(newData1, options);

    {% for each in cities %}
    var diffData_{{ each.id }} = colChartDiff.computeDiff(oldData, newData{{ each.id }});
    diff_{{ each.id }}.draw(diffData_{{ each.id }}, options);
    {% endfor %}

  }

</script>
{% endblock %}

{% block content %}

<div class="row">

  <div class="col-2 p-3 bg-body-tertiary">
    {% include "_menu.city.html" %}
  </div>

  <div class="col-10">

  <div class="bg-body-tertiary mb-3">
    <ul class="nav nav-pills mb-auto text-center">
      <li class="nav-item">
        <a href="#" title="Table" class="nav-link active py-3 border-bottom rounded-0">
          <i class="bi bi-table"></i>
        </a>
      </li>
      <li>
        <a href="#" title="Charts" class="nav-link py-3 border-bottom rounded-0">
          <i class="bi bi-bar-chart-fill"></i>
        </a>
      </li>
    </ul>
  </div>

    <h2>Ideal Diet Analysis</h2>

<span id='colchart_before' style='width: 450px; height: 250px; display: inline-block'></span>
<span id='colchart_after' style='width: 450px; height: 250px; display: inline-block'></span>
<span id='colchart_diff' style='width: 450px; height: 250px; display: inline-block'></span>

<div>
{% for each in cities %}
<span id='diff_{{ each.id }}' style='width: 750px; height: 850px; display: inline-block'></span>
{% endfor %}
</div>

  </div>

</div>

{% endblock %}
